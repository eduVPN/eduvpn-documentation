define EXTERNAL_IF = eth0

table inet filter {
	chain input {
		type filter hook input priority filter; policy drop;
		ct state vmap { invalid : drop, established : accept, related : accept }
		iif "lo" accept
		tcp dport { 22, 1194 } accept
		udp dport { 1194, 51820 } accept

		# vpn-daemon
		#ip saddr 192.0.2.10/32 tcp dport 41194 accept
		#ip6 saddr 2001:db8::10/128 tcp dport 41194 accept

		icmp type echo-request limit rate 5/second accept
		icmpv6 type { echo-request limit rate 5/second, nd-router-advert, nd-neighbor-solicit, nd-neighbor-advert } accept
	}

	chain forward {
		type filter hook forward priority filter; policy drop;
		tcp flags syn tcp option maxseg size set rt mtu
		ct state vmap { invalid : drop, established : accept, related : accept }
		iifname { "tun0", "tun1", "wg0" } oifname $EXTERNAL_IF accept
	}

	chain postrouting {
		type nat hook postrouting priority srcnat; policy accept;
		ip saddr { 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 } oifname $EXTERNAL_IF masquerade
		ip6 saddr fc00::/7 oifname $EXTERNAL_IF masquerade
	}
}
